# 프로세스와 스레드

## 프로세스 process

실행 중인 프로그램을 프로세스라고 한다. 프로그램은 실행되기 전까지는 그저 보조기억장치에 있는 데이터 덩어리일 뿐이지만, 보조기억 장치에 저장된 프로그램을 메모리에 적재하고 실행하는 순간 프로그램은 프로세스가 된다.

- 포그라운드 프로세스 forground process: 사용자가 볼 수 있는 공간에서 실행되는 프로세스
- 백그라운드 프로세스 background process: 사용자가 보지 못하는 곳에서 실행되는 프로세스
  - 데몬 deamon: 유닉스 체계의 운영체제에서의 백그라운드 프로세스
  - 서비스 service: 윈도우에서의 백그라운드 프로세스

## 프로세스 제어 블록(PCB: Process Control Block)

운영체제는 빠르게 번갈아 수행되는 프로세스의 실행 순서를 관리하고, 프로세스에 CPU를 비롯한 자원을 분배한다. 이를 위해 운영체제는 프로세스 제어 블록을 이용한다.

- PCB는 관련된 정보를 저장하는 자료구조이다. 프로세스를 식별하기 위해 꼭 필요한 정보들이 저장된다. 마치 상품에 달린 태그와도 같다.
- PCB는 커널 영역에 저장된다.
- PCB는 프로세스 생성 시에 만들어지고 실행이 끝나면 폐기 된다.
- PCB에 담기는 정보
  - 프로세스 ID(PID: process ID)  
    특정 프로세스를 식별하기 위해 부여하는 고유한 번호이다.
  - 레지스터 값  
    프로세스는 자신의 차례가 돌아오면 이전까지 사용했던 레지스터의 중간 값들을 모두 복원한다. 해당 프로세스가 사용했던 프로그램 카운터를 비롯한 레지스터 값들이 담긴다.
  - 프로세스 상태  
    입출력장치 사용 대기 중인지, CPU 이용 대기 중인지 상태 정보가 저장된다.
  - CPU 스케줄링 정보  
    프로세스가 언제, 어떤 순서로 CPU를 할당받을지에 대한 정보이다.
  - 메모리 관리 정보  
    프로세스마다 메모리에 저장된 위치가 다르기 때문에 어느 주소에 저장되어 있는지에 대한 정보이다.
  - 사용한 파일과 입출력장치 목록  
    프로세스가 실행 과정에서 특정 입출력장치나 파일을 사용하면 해당 내용이 명시된다.

## 문맥교환 Context Switching

하나의 프로세스에서 다른 프로세스로 실행 순서가 넘어가면 실행되던 프로세스는 지금까지의 중간 정보를 백업해야 한다. 이러한 중간 정보, 즉 하나의 프로세스를 수행을 재개하기 위해 기억해야 할 정보를 문맥이라고 한다. 문맥은 해당 프로세스의 PCB에 표현되어 있다.  
기존 프로세스의 문맥을 PCB에 백업하고, 새로운 프로세스를 실행하기 위해 문맥을 PCB로부터 복구하여 새로운 프로세스르 실행하는 것을 문맥 교환이라고 한다.  
<img width="557" alt="image" src="https://user-images.githubusercontent.com/88878874/224452882-aa72db89-87af-4f92-beca-e56c577614e2.png">

## 프로세스의 메모리 영역

<img width="174" alt="image" src="https://user-images.githubusercontent.com/88878874/224454270-83efbf54-5efc-4852-bf0c-a53be2ce1ed4.png">

### 코드 영역 code segment

코드 영역은 텍스트 영역이라고도 부른다. 실행할 수 있는 코드로 이루어진 명령어가 저장된다. 읽기 전용 공간이다.

### 데이터 영역 data segment

프로그램이 실행되는 동안 유지할 데이터가 저장되는 공간이다. 대표적으로 전역 변수가 있다.  
코드 영역과 데이터 영역은 크기가 변하지 않는다. '크기가 고정된'영역이라는 점에서 **정적 할당 영역**이라고도 부른다. 반면에 힙 영역과 스택 영역은 프로세스 실행 과정에서 그 크기가 변할 수 있는 영역이며 **동적 할당 영역**이라고도 부른다.

### 힙 영역 heap segment

프로그래머가 직접 할당할 수 있는 저장 공간이다. 프로그래밍 과정에서 힙 영역에 메모리 공간을 할당했다면 언젠가는 해당 공간을 반환해야 한다.  
메모리 공간을 반환하지 않는다면 할당한 공간은 메모리 내에 계속 남아 메모리 낭비를 초래한다. 이런 문제를 **메모리 누수**memory leak라고 한다.  
힙 영역은 메모리의 낮은 주소에서 높은 주소로 할당된다.

## 스택 영역 stack segment

데이터를 일시적으로 저장하는 공간이다. 데이터 영역과 달리 잠깐 쓰는 값들이 저장되는 공간이다. 이런 데이터로는 함수의 실행이 끝나면 사라지는 매개 변수, 지역 변수가 대표적이다.  
일시적으로 저장할 데이터는 스텍 영역에 push 되고, 더 이상 필요하지 않은 데이터는 pop 됨으로써 스택 영역에서 사라진다.  
힙 영역과 스텍 영역은 실시간으로 크기가 변할 수 있기 때문에 동적 할당 영역이라고 부른다. 스택 영역은 높은 주소에서 낮은 주소로 할당된다.
